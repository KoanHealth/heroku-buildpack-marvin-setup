#!/usr/bin/env ruby

# sync output
$stdout.sync = true

$:.unshift File.expand_path("../../lib", __FILE__)
require "language_pack"
require "language_pack/shell_helpers"
DEPLOY_PATH='./deploy'


LanguagePack::Instrument.trace 'compile', 'app.compile' do
  puts 'installing Bundler'
  LanguagePack::Helpers::BundlerWrapper.new.install
  puts 'cloning deploy repo'
  `git clone git@github.com:KoanHealth/Deploy.git #{DEPLOY_PATH}`
  puts 'Compile dir files:'
  puts "Files:"
  Dir.foreach(Dir.getwd) do |file_name|
    puts file_name
  end

  Dir.chdir(DEPLOY_PATH) do
    puts "In #{Dir.pwd}"
    puts "Deploy Files:"
    Dir.foreach(Dir.getwd) do |file_name|
      puts file_name
    end
    puts 'Running deploy setup'
    `script/setup`
  end
end
